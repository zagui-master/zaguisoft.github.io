import{paymentForm}from"../helpers/locatores.js";import{changeStateCourse}from"./change-state-course.js";import{paymentGatewayData}from"../data/credit-card-data.js";import{showCoursesToPayment}from"./show-courses-to-payment.js";import{calculateFinalPriceInPayment}from"./calculate-final-price-in-payment.js";import{numberOfCoursesAdded}from"./count-number-of-courses-added.js";import{showModalLoader}from"./modal-loader.js";import{dissipatedAnimation}from"./dissipated-animation.js";const{form:form,cardNumber:cardNumber,cardholderName:cardholderName,cardYear:cardYear,cardMonth:cardMonth,securityCode:securityCode,alertCardNumber:alertCardNumber,alertCardholderName:alertCardholderName,contenInputMonthYear:contenInputMonthYear,alertMonthYear:alertMonthYear,alertSecurityCode:alertSecurityCode}=paymentForm,{data_card_number:data_card_number,data_cardholder_name:data_cardholder_name,data_card_month:data_card_month,data_card_year:data_card_year,data_security_code:data_security_code}=paymentGatewayData;let state={card_number:!1,cardholder_name:!1,card_year:!1,card_month:!1,security_code:!1};const getCurrentUser=()=>JSON.parse(sessionStorage.getItem("current_user"))||[],getCoursesToPay=e=>JSON.parse(localStorage.getItem(`${e}`))||[],getPurchasedCourse=e=>JSON.parse(localStorage.getItem(`purchased_${e}`))||[],buyCourse=()=>{const e=JSON.parse(sessionStorage.getItem("current_user"))||[],a=[...getPurchasedCourse(e),...getCoursesToPay(e)];localStorage.setItem(`purchased_${e}`,JSON.stringify(a)),localStorage.removeItem(e),showCoursesToPayment(),calculateFinalPriceInPayment(),changeStateCourse()},validateCardNumber=(e,a,r,t)=>{parseInt(e.value)===r?(t.card_number=!0,a.innerText="",a.classList.remove("alert-text"),e.classList.remove("alert-input")):(a.innerText="Incorret number",a.classList.add("alert-text"),e.classList.add("alert-input"))},validateCardholderName=(e,a,r,t)=>{e.value===r?(t.cardholder_name=!0,a.innerText="",a.classList.remove("alert-text"),e.classList.remove("alert-input")):(a.innerText="Incorret cardholder name",a.classList.add("alert-text"),e.classList.add("alert-input"))},validateCardMonthYear=(e,a,r,t,d,s,o)=>{parseInt(e.value)===d&&parseInt(a.value)===s?(r.innerText="",r.classList.remove("alert-text"),t.classList.remove("alert-input"),o.card_year=!0,o.card_month=!0):(r.innerText="Incorret month or year",r.classList.add("alert-text"),t.classList.add("alert-input"))},validateSecurityCode=(e,a,r,t)=>{parseInt(e.value)===r?(t.security_code=!0,a.innerText="",a.classList.remove("alert-text"),e.classList.remove("alert-input")):(a.innerText="Incorret security code",a.classList.add("alert-text"),e.classList.add("alert-input"))};form.addEventListener("submit",(e=>{e.preventDefault(),validateCardNumber(cardNumber,alertCardNumber,data_card_number,state),validateCardholderName(cardholderName,alertCardholderName,data_cardholder_name,state),validateCardMonthYear(cardMonth,cardYear,alertMonthYear,contenInputMonthYear,data_card_month,data_card_year,state),validateSecurityCode(securityCode,alertSecurityCode,data_security_code,state),state.card_number&&state.cardholder_name&&state.card_month&&state.card_year&&state.security_code&&(numberOfCoursesAdded(),buyCourse(),form_payment.reset(),showModalLoader(),dissipatedAnimation())}));